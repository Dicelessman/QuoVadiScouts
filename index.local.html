<!doctype html>
<html lang="it" class="no-js">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes" />
<title>Quovadiscout - Strutture & Terreni (Local)</title>
<script>
  document.documentElement.classList.remove('no-js');
  document.documentElement.classList.add('js');
</script>
<!-- CSS critico inline per first paint -->
<style id="critical-css">
  html, body { margin: 0; padding: 0; height: 100%; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
  .app-header { display: flex; align-items: center; min-height: 56px; padding: 8px 12px; background: #2f6b2f; color: #fff; }
  .app-title { font-size: 18px; margin: 0; }
  .main-map-container { min-height: 280px; }
  .results-container { display: grid; gap: 12px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); }
  .loading-indicator { display: none; }
  .loading-indicator .loading-spinner { width: 24px; height: 24px; border: 3px solid #e0e0e0; border-top-color: #2f6b2f; border-radius: 50%; animation: spin 1s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
<meta name="description" content="Sistema avanzato per la gestione di strutture e terreni scout" />
<meta name="theme-color" content="#2f6b2f" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="QuoVadiScout" />
<script>
  (function(){
    window.DEBUG = window.DEBUG === true ? true : false;
    if (!window.__console) {
      window.__console = {
        log: console.log.bind(console),
        info: (console.info || console.log).bind(console),
        debug: (console.debug || console.log).bind(console),
        warn: (console.warn || console.log).bind(console),
        error: console.error.bind(console)
      };
    }
    if (!window.log) {
      window.log = {
        info: (...args) => window.DEBUG && window.__console.log(...args),
        debug: (...args) => window.DEBUG && window.__console.debug(...args),
        warn: (...args) => window.__console.warn(...args),
        error: (...args) => window.__console.error(...args)
      };
    }
  })();
</script>
<link rel="preconnect" href="https://www.gstatic.com" crossorigin>
<link rel="preconnect" href="https://unpkg.com" crossorigin>
<link rel="preconnect" href="https://a.tile.openstreetmap.org" crossorigin>
<!-- preconnect limitati a 3 origini: gstatic, unpkg, OSM (a) -->
<style>
  /* Font Awesome: forza font-display: swap per i webfont */
  @font-face {
    font-family: "Font Awesome 6 Free";
    font-style: normal;
    font-weight: 900;
    font-display: swap;
    src: url("https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/webfonts/fa-solid-900.woff2") format("woff2");
  }
  @font-face {
    font-family: "Font Awesome 6 Free";
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: url("https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/webfonts/fa-regular-400.woff2") format("woff2");
  }
</style>
<link rel="preload" href="/styles.css" as="style">
<link rel="manifest" href="manifest.json" />
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèïÔ∏è</text></svg>">
<link rel="preload" href="styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="styles.css"></noscript>
<link rel="preload" href="geolocation-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="geolocation-styles.css"></noscript>
<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
<script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript" defer></script>
<script src="firebase-config.local.js" defer></script>
<script src="cloudinary-config.local.js" defer></script>
<!-- Export libraries caricati on-demand in export.js -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" as="style">
<link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" /></noscript>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js" defer></script>
<link rel="preload" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" /></noscript>
<link rel="preload" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" /></noscript>
</head>
<body>
  <noscript>
    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #f5f5f5; display: flex; align-items: center; justify-content: center; z-index: 99999; padding: 2rem;">
      <div style="text-align: center; max-width: 500px;">
        <h1 style="color: #2f6b2f; margin-bottom: 1rem;">üèïÔ∏è QuoVadiScout</h1>
        <h2 style="color: #333; margin-bottom: 1rem;">JavaScript √® richiesto</h2>
        <p style="color: #666; margin-bottom: 1.5rem;">Questa applicazione richiede JavaScript per funzionare correttamente. Per favore abilita JavaScript nel tuo browser.</p>
        <p style="color: #999; font-size: 0.9rem;">Abilita JavaScript e ricarica la pagina.</p>
      </div>
    </div>
  </noscript>
  
  <a href="#main-content" class="sr-only skip-link">Salta al contenuto principale</a>
  
  <header class="app-header">
    <div class="header-main">
      <div class="header-brand">
        <h1 class="app-title">üèïÔ∏è QuoVadiScout </h1>
      </div>
      <div class="header-actions">
        <button id="menuToggle" class="btn-menu" aria-label="Menu principale">
          <span class="hamburger"></span>
        </button>
      </div>
    </div>
  </header>

  <div class="search-section" role="search">
    <div class="search-container">
      <input id="search" class="search-input" placeholder="Cerca strutture..." />
    </div>
  </div>

  <div id="mainMapContainer" class="main-map-container">
    <div class="map-header">
      <h3 class="map-title">üó∫Ô∏è Mappa Strutture</h3>
      <div class="map-controls">
        <button id="centerMapBtn" class="btn-map-control" title="Centro su di me">üìç</button>
        <button id="toggleMapBtn" class="btn-map-control" title="Mostra/Nascondi mappa">üëÅÔ∏è</button>
      </div>
    </div>
    <div id="mainMap" class="main-map"></div>
  </div>

  <nav id="mainMenu" class="main-menu hidden" role="navigation" aria-label="Menu principale">
    <div class="menu-sections">
      <section class="menu-section">
        <h3 class="menu-section-title">üîç Ricerca & Filtri</h3>
        <div class="menu-items">
          <button class="menu-item" onclick="mostraRicercaAvanzata()">
            <span class="menu-icon"><i class="fas fa-search"></i></span>
            <span class="menu-label">Ricerca Avanzata</span>
          </button>
          <button class="menu-item" onclick="mostraMappa()">
            <span class="menu-icon"><i class="fas fa-map-marked-alt"></i></span>
            <span class="menu-label">Visualizza Mappa</span>
          </button>
          <button class="menu-item" id="sortMenuBtn">
            <span class="menu-icon"><i class="fas fa-sort-amount-down"></i></span>
            <span class="menu-label">Ordina per</span>
            <select id="sort-by" class="menu-select">
              <option value="struttura">Nome</option>
              <option value="luogo">Luogo</option>
              <option value="provincia">Provincia</option>
            </select>
          </button>
          <button class="menu-item" id="savedFiltersBtn">
            <span class="menu-icon"><i class="fas fa-bookmark"></i></span>
            <span class="menu-label">Filtri Salvati</span>
            <select id="saved-filters" class="menu-select">
              <option value="">Seleziona filtro...</option>
            </select>
          </button>
        </div>
      </section>

      <section class="menu-section">
        <h3 class="menu-section-title">üìã Le Mie Liste</h3>
        <div class="menu-items">
          <button id="exportBtn" class="menu-item">
            <span class="menu-icon"><i class="fas fa-list"></i></span>
            <span class="menu-label">Elenco Personale</span>
            <span id="contatore-elenco" class="menu-badge">0</span>
          </button>
        </div>
      </section>

      <section class="menu-section">
        <h3 class="menu-section-title">‚ö° Azioni Rapide</h3>
        <div class="menu-items">
          <button id="add-btn" class="menu-item menu-item-accent">
            <span class="menu-icon"><i class="fas fa-plus"></i></span>
            <span class="menu-label">Aggiungi Struttura</span>
          </button>
          <button id="resetBtn" class="menu-item">
            <span class="menu-icon"><i class="fas fa-undo"></i></span>
            <span class="menu-label">Reset Filtri</span>
          </button>
          <div class="view-toggle menu-item">
            <span class="menu-icon"><i class="fas fa-eye"></i></span>
            <span class="menu-label">Visualizzazione</span>
            <button id="viewToggle" class="view-switch">
              <span class="view-icon"><i class="fas fa-list"></i></span>
              <span class="view-label">Elenco</span>
            </button>
          </div>
        </div>
      </section>

      <section class="menu-section">
        <h3 class="menu-section-title">üìä Gestione Dati</h3>
        <div class="menu-items">
          <button class="menu-item" onclick="mostraModaleSincronizzazione()">
            <span class="menu-icon"><i class="fas fa-sync-alt"></i></span>
            <span class="menu-label">Sincronizza con Firestore</span>
          </button>
          <button class="menu-item" onclick="mostraOpzioniEsportazioneGenerale()">
            <span class="menu-icon"><i class="fas fa-download"></i></span>
            <span class="menu-label">Esporta Dati</span>
          </button>
          <button class="menu-item" onclick="mostraFeedAttivita()">
            <span class="menu-icon"><i class="fas fa-history"></i></span>
            <span class="menu-label">Feed Attivit√†</span>
          </button>
          <button class="menu-item" onclick="location.href='dashboard.html'">
            <span class="menu-icon"><i class="fas fa-chart-line"></i></span>
            <span class="menu-label">Dashboard</span>
          </button>
        </div>
      </section>

      <section class="menu-section">
        <h3 class="menu-section-title">‚öôÔ∏è Impostazioni</h3>
        <div class="menu-items">
          <button id="themeToggle" class="menu-item">
            <span class="menu-icon"><i class="fas fa-moon"></i></span>
            <span class="menu-label">Cambia Tema</span>
          </button>
          <button id="userBtn" class="menu-item">
            <span class="menu-icon"><i class="fas fa-user"></i></span>
            <span class="menu-label">Utente</span>
          </button>
        </div>
      </section>

      <section class="menu-section">
        <h3 class="menu-section-title">üÜò Aiuto & Supporto</h3>
        <div class="menu-items">
          <button class="menu-item" onclick="mostraAiuto()">
            <span class="menu-icon"><i class="fas fa-question-circle"></i></span>
            <span class="menu-label">Guida Rapida</span>
          </button>
          <button class="menu-item" onclick="mostraAbout()">
            <span class="menu-icon"><i class="fas fa-info-circle"></i></span>
            <span class="menu-label">Informazioni App</span>
          </button>
          <button class="menu-item" onclick="runSystemTests()">
            <span class="menu-icon"><i class="fas fa-flask"></i></span>
            <span class="menu-label">Test Sistemi</span>
          </button>
        </div>
      </section>
    </div>
  </nav>

  <main id="main-content" class="main-content" role="main">
    <div class="results-header">
      <div class="results-info">
        <span id="resultsCount" class="results-count">0 strutture</span>
        <span id="resultsStatus" class="results-status"></span>
      </div>
    </div>
    <section id="results" class="results-container"></section>
    <div id="loadingIndicator" class="loading-indicator hidden">
      <div class="loading-spinner"></div>
      <span class="loading-text">Caricamento...</span>
    </div>
    <div id="emptyState" class="empty-state hidden">
      <div class="empty-icon"><i class="fas fa-search"></i></div>
      <h3 class="empty-title">Nessuna struttura trovata</h3>
      <p class="empty-description">Prova a modificare i filtri o aggiungi una nuova struttura</p>
      <button id="addBtnEmpty" class="btn-primary"><i class="fas fa-plus"></i> Aggiungi Struttura</button>
    </div>
  </main>

  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <button id="closeModal" class="close"><i class="fas fa-times"></i></button>
      <h2>Modifica struttura</h2>
      <form id="editForm"></form>
      <div class="modal-actions">
        <button id="saveBtn"><i class="fas fa-save"></i> Salva</button>
        <button id="deleteBtn" class="danger"><i class="fas fa-trash"></i> Elimina</button>
        <button id="cancelBtn"><i class="fas fa-times"></i> Annulla</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      if (window.log) {
        console.log = function() { window.log.info.apply(window.log, arguments); };
        console.info = function() { window.log.info.apply(window.log, arguments); };
        console.debug = function() { window.log.debug.apply(window.log, arguments); };
      }
    })();
  </script>

  <script src="dist/maps.js" defer></script>
  <script src="dist/export.js" defer></script>
  <script src="dist/push-notifications.js" defer></script>
  <script src="dist/offline-sync.js" defer></script>
  <script src="dist/media-manager.js" defer></script>
  <script src="dist/virtual-scroll.js" defer></script>
  <script src="dist/integrations.js" defer></script>
  <script src="dist/gestures.js" defer></script>
  <script src="dist/smart-notifications.js" defer></script>
  <script src="dist/analytics.js" defer></script>
  <script src="dist/backup-sync.js" defer></script>
  <script src="dist/config.js" defer></script>
  <script src="dist/test-systems.js" defer></script>
  <script src="dist/toast-notifications.js" defer></script>
  <script src="dist/geolocation-config.js" defer></script>
  <script src="dist/geolocation.js" defer></script>
  <script src="dist/geolocation-ui.js" defer></script>
  <script src="dist/geolocation-integration.js" defer></script>
  <script src="dist/icons-config.js" defer></script>
  <!-- Sentry (opzionale) -->
  <!-- Sentry disabilitato in locale (DSN vuoto) -->
  <script src="sentry-config.local.js" defer></script>
  <script src="dist/error-handler.js" defer></script>
  <script type="module" src="dist/script.js"></script>
</body>
</html>
